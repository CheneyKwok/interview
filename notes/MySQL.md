# MySQL

## MySQL 有哪几种数据存储引擎？有什么区别

通过 show engines 指令可以看到所有支持的数据存储引擎。最常用的是 MyISAM 和 InnoDB 两种

MyISAM 和 InnoDB 区别：

- 存储文件。MyISAM 每个表有两个文件。MYD 数据文件 和 MYISAM 索引文件。而 InnoDB 每个表只有一个 idb 文件
- InnoDB 支持事务、支持行级锁、支持外键
- InnoDB 支持 XA 事务 (分布式事务协议) XA START/END/PREPARE/COMMIT
  - XA 事务就是两阶段提交的一种实现方式，定义了事务管理器 TM 和资源管理器 RM 之间的接口
  - prepare 阶段： TM 向所有 RM 发送 prepare 指令，RM 接受指令后执行数据修改和日志记录，返回是否可以提交给 TM
  - commit 阶段：TM 接受所有 RM 的 prepare 结果，如果所有 RM 均返回可以提交，则向所有 RM 发送事务提交命令，如果有 RM 返回不可提交或超时，则向所有 RM 发送事务回滚命令
- InnoDB 支持 Savepoints （提供一种部分回滚的机制)

## 什么是脏读、幻读、不可重复读？要怎么处理

脏读：在事务进行过程中，读到了其他事务未提交的数据

不可重复读：在一个事务过程中，多次查询的结果不一致

幻读：在一个事务过程中，用同样的操作查询数据，得到的记录数不相同

处理的方式有很多种：加锁、事务隔离、MVCC

- 加锁
  
  脏读：在修改时加独占锁，直达事务提交才释放。读取时加共享锁，读完释放

  不可重复读：读数据时加共享锁，写数据时加独占锁

  幻读：加范围锁

## 事务的基本特性和隔离级别有哪些

事务：表示多个数据操作组成一个完整的事务单元，这个事务内的所有数据操作要么同时成功，要么同时失败

事务的特性：ACID

1、原子性: 事务是不可分割的，要么完全成功，要么完全失败

2、一致性：事务无论是完成还是失败，都必须保持事务内操作的一致性。当失败时，都要对前面的操作进行回滚，不管中途是否成功

3、隔离性：当多个事务操作一个数据的时候，为防止数据损坏，需要将每个事务进行隔离，互相不打扰

4、持久性：事务开始就不会终止。他的结果不受其他外在因素影响

事务的隔离级别

指令 show VARIABLES like 'TRANSACTION%'

set transaction level xxx 设置下次事务的隔离级别
set session transaction level xxx 设置当前会话的事务的隔离级别
